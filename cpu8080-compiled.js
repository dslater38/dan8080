(function(x){var t;"undefined"===typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t={},define(function(){return t})):t="undefined"!==typeof window?window:x:t=exports;(function(t){function x(m,k,q,aa){Object.defineProperty(m,aa,{enumerable:!0,get:function(){return k.getUint16(2*q,!0)},set:function(m){k.setUint16(2*q,m,!0)}})}function ba(m,k,q){return E?new Uint16Array(m,k,q):new function(k,m,q){k=new DataView(k,m,q);for(var t=0;6>t;++t)x(this,k,t,t.toString());Object.defineProperty(this,
"byteLength",{enumerable:!0,writable:!1,value:q});Object.defineProperty(this,"byteOffset",{enumerable:!0,writable:!1,value:m});Object.defineProperty(this,"buffer",{enumerable:!0,writable:!1,value:k.buffer})}(m,k,q)}var E=function(){var m=new ArrayBuffer(2);(new DataView(m)).setUint16(0,256,!0);return 256===(new Uint16Array(m))[0]}(),M={create:function(m){function k(){return g[d[5]++]}function q(){var a=d[5];d[5]+=2;return w.getUint16(a,!0)}function t(a){d[4]-=2;w.setUint16(d[4],a,!0)}function x(){var a=
w.getUint16(d[4],!0);d[4]+=2;return a}function N(){var e=k();b[e]();a[0]&32&&F&&(a[0]&=-33,F=!1,e=b[O],"function"==typeof e&&e());return!0}function E(e,b){Object.defineProperty(u,e,{enumerable:!0,get:function(){return g[a[b]]},set:function(e){g[a[b]]=e}})}function P(e,b){Object.defineProperty(u,e,{enumerable:!0,get:function(){return a[b]},set:function(e){a[b]=e}})}function M(a,b){Object.defineProperty(u,a,{enumerable:!0,get:function(){return d[b]},set:function(a){d[b]=a}})}function ca(e,b){Object.defineProperty(u,
e,{enumerable:!0,get:function(){return(a[0]&b)==b},set:function(e){a[0]=e?a[0]|b:a[0]&~b}})}function y(){return 0!=(a[0]&1)}function Q(e){var b=a[0],b=0==e?b|64:b&-65,b=e&128?b|128:b&-129,b=R[e]?b|4:b&-5;a[0]=b}function C(e){var b=a[0],b=0==e?b|64:b&-65,b=e&128?b|128:b&-129,b=R[e]?b|4:b&-5;a[0]=255<e?b|1:b&-2}function da(a){d[a]=q()}function S(e){a[1]=g[d[e]]}function T(e){g[d[e]]=a[1]}function z(e){var b=a[1],c=b+e;a[1]=c;C(c);a[0]=0!=((e^c^b)&16)?a[0]|16:a[0]&-17}function ea(){z(g[d[r]])}function fa(e){z(a[e])}
function n(a,b){return a.bind(A,b)}function ga(){z(g[d[r]]+(y()?1:0))}function ha(e){z(a[e]+(y()?1:0))}function B(e){var b=a[1],c=b-e;a[1]=c;C(c);a[0]=0!=((e^c^b)&16)?a[0]|16:a[0]&-17}function ia(){B(g[d[r]])}function ja(e){B(a[e])}function ka(){B(g[d[r]]+(y()?1:0))}function la(e){B(a[e]+(y()?1:0))}function U(e){++e;Q(e);a[0]=0!=(e&15)?a[0]|16:a[0]&-17;return e}function ma(){var a=d[r];g[a]=U(g[a])}function na(b){a[b]=U(a[b])}function V(b){--b;Q(b);a[0]=0==(b&15)?a[0]|16:a[0]&-17;return b}function oa(){var a=
d[r];g[a]=V(g[a])}function pa(b){a[b]=V(a[b])}function qa(a){++d[a]}function ra(a){--d[a]}function sa(b){b=d[r]+d[b];a[0]=65535<b?a[0]|1:a[0]&-2;d[r]=b}function G(b){b&=a[1];C(b);a[1]=b&255;a[0]&=-17}function ta(){G(g[d[r]])}function ua(b){G(a[b])}function H(b){b|=a[1];C(b);a[1]=b&255;a[0]&=-17}function va(){H(g[d[r]])}function wa(b){H(a[b])}function I(b){b^=a[1];C(b);a[1]=b&255;a[0]&=-17}function xa(){I(g[d[r]])}function ya(b){I(a[b])}function J(b){var c=a[1]-b&255,d=a[0],d=0!=b&&c>=a[1]?d|1:d&-2,
d=(a[1]^b^c)&16?d|16:d&-17,d=0==c?d|64:d&-65;a[0]=(c&128?d|128:d&-129)&255}function za(){J(g[d[r]])}function Aa(b){J(a[b])}function Ba(b){var c=q();a[0]&b&&(d[5]=c)}function Ca(b){var c=q();a[0]&b||(d[5]=c)}function Da(e){if(a[0]&e)b[205]();else q()}function Ea(e){if(a[0]&e)q();else b[205]()}function Fa(e){if(a[0]&e)b[201]()}function Ga(e){if(!(a[0]&e))b[201]()}function Ha(a){t(d[5]);d[5]=8*a}function W(a){t(d[a])}function X(a){d[a]=x()}var A=this,b=[],v=new ArrayBuffer(12+m),a=new Uint8Array(v,0,
12),d=ba(v,0,6),w=new DataView(v,12,m),g=new Uint8Array(v,12,m),K=[],L=[],O=0,F=!1,p=[3,2,5,4,7,6,6,1],f="B C D E H L iHL A".split(" ");m=[1,2,3,4,5];var l=["BC","DE","HL","SP","PC"],h=m[0],D=m[1],r=m[2],Y="CF PF HF IF ZF SF".split(" "),Ia=[1,4,16,32,64,128],v=[64,64,1,1,4,4,128,128],u={cycles:0},Z={writable:!0,enumerable:!0,configurable:!0},c=function(a,b,c){Z.value=c;Object.defineProperty(a,b,Z)};c(u,"interrupt",function(b){a[0]&32?(F=!0,O=b,b=!0):b=!1;return b});c(u,"step",function(){N()});c(u,
"run",function(a){for(var b=0;b<a;++b)N()});c(u,"reset",function(){for(var b=0;b<a.byteLength;++b)a[b]=0;for(b=0;b<w.byteLength;++b)g[b]=0});c(u,"load",function(a,b){0<=a&&65536>a&&0<b.length&&b.length<65536-a&&g.set(b,a)});c(u,"attachPort",function(a,b,c){if(0>a||255<a)throw"Error: 0 <= port_number <= 255";K[a]="function"==typeof b?b:void 0;L[a]=c});Object.defineProperty(u,"ram",{enumerable:!0,get:function(){return w}});for(c=0;c<f.length;++c)6==c?E(f[c],p[c]):P(f[c],p[c]);P("F",0);for(c=0;c<l.length;++c)M(l[c],
m[c]);for(c=0;c<Y.length;++c)ca(Y[c],Ia[c]);var R=[!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,
!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0,!0,!1,!1,!0,!1,!0,!0,!1,!0,!1,!1,!0,!1,!0,!0,!1,!1,!0,!0,!1,!0,!1,!1,!0];b[0]=function(){};b[64]=function(){};b[65]=function(){a[3]=a[2]};b[66]=function(){a[3]=a[5]};b[67]=function(){a[3]=a[4]};b[68]=function(){a[3]=a[7]};b[69]=function(){a[3]=a[6]};b[70]=
function(){a[3]=g[d[3]]};b[71]=function(){a[3]=a[1]};b[72]=function(){a[2]=a[3]};b[73]=function(){};b[74]=function(){a[2]=a[5]};b[75]=function(){a[2]=a[4]};b[76]=function(){a[2]=a[7]};b[77]=function(){a[2]=a[6]};b[78]=function(){a[2]=g[d[3]]};b[79]=function(){a[2]=a[1]};b[80]=function(){a[5]=a[3]};b[81]=function(){a[5]=a[2]};b[82]=function(){};b[83]=function(){a[5]=a[4]};b[84]=function(){a[5]=a[7]};b[85]=function(){a[5]=a[6]};b[86]=function(){a[5]=g[d[3]]};b[87]=function(){a[5]=a[1]};b[88]=function(){a[4]=
a[3]};b[89]=function(){a[4]=a[2]};b[90]=function(){a[4]=a[5]};b[91]=function(){};b[92]=function(){a[4]=a[7]};b[93]=function(){a[4]=a[6]};b[94]=function(){a[4]=g[d[3]]};b[95]=function(){a[4]=a[1]};b[96]=function(){a[7]=a[3]};b[97]=function(){a[7]=a[2]};b[98]=function(){a[7]=a[5]};b[99]=function(){a[7]=a[4]};b[100]=function(){};b[101]=function(){a[7]=a[6]};b[102]=function(){a[7]=g[d[3]]};b[103]=function(){a[7]=a[1]};b[104]=function(){a[6]=a[3]};b[105]=function(){a[6]=a[2]};b[106]=function(){a[6]=a[5]};
b[107]=function(){a[6]=a[4]};b[108]=function(){a[6]=a[7]};b[109]=function(){};b[110]=function(){a[6]=g[d[3]]};b[111]=function(){a[6]=a[1]};b[112]=function(){g[d[3]]=a[3]};b[113]=function(){g[d[3]]=a[2]};b[114]=function(){g[d[3]]=a[5]};b[115]=function(){g[d[3]]=a[4]};b[116]=function(){g[d[3]]=a[7]};b[117]=function(){g[d[3]]=a[6]};b[119]=function(){g[d[3]]=a[1]};b[120]=function(){a[1]=a[3]};b[121]=function(){a[1]=a[2]};b[122]=function(){a[1]=a[5]};b[123]=function(){a[1]=a[4]};b[124]=function(){a[1]=
a[7]};b[125]=function(){a[1]=a[6]};b[126]=function(){a[1]=g[d[3]]};b[127]=function(){};b[6]=function(){a[3]=k()};b[14]=function(){a[2]=k()};b[22]=function(){a[5]=k()};b[30]=function(){a[4]=k()};b[38]=function(){a[7]=k()};b[46]=function(){a[6]=k()};b[54]=function(){g[d[3]]=k()};b[62]=function(){a[1]=k()};for(c=f=0;4>c;++c)l=f|c<<4|1,b[l]=da.bind(A,m[c]);b[58]=function(){a[1]=g[q()]};b[50]=function(){g[q()]=a[1]};b[42]=function(){d[r]=w.getUint16(q(),!0)};b[34]=function(){w.setUint16(q(),d[r],!0)};
b[f|10]=S.bind(A,h);b[f|26]=S.bind(A,D);b[f|2]=T.bind(A,h);b[f|18]=T.bind(A,D);b[235]=function(){var a=d[D];d[D]=d[r];d[r]=a};f=128;for(h=0;8>h;++h)l=f|h,b[l]=6==h?ea:n(fa,p[h]);f=192;b[198]=function(){z(k())};f=136;for(h=0;8>h;++h)l=f|h,b[l]=6==h?ga:n(ha,p[h]);b[206]=function(){z(k()+(y()?1:0))};f=144;for(h=0;8>h;++h)l=f|h,b[l]=6==h?ia:n(ja,p[h]);f=192;b[214]=function(){B(k())};f=152;for(h=0;8>h;++h)l=f|h,b[l]=6==h?ka:n(la,p[h]);b[222]=function(){B(k()+(y()?1:0))};f=4;for(c=0;8>c;++c)l=f|c<<3,b[l]=
6==c?ma:n(na,p[c]);f=5;for(c=0;8>c;++c)l=f|c<<3,b[l]=6==c?oa:n(pa,p[c]);f=3;for(c=0;4>c;++c)l=f|c<<4,b[l]=n(qa,m[c]);f=11;for(c=0;4>c;++c)l=f|c<<4,b[l]=n(ra,m[c]);f=9;for(c=0;4>c;++c)l=f|c<<4,b[l]=n(sa,m[c]);b[39]=function(){9<(a[1]&15)||a[0]&16?(a[1]+=6,a[0]|=16):a[0]&=-17;159<a[1]||a[0]&1?(a[1]+=96,a[0]|=1):a[0]&=-2;a[0]=0==a[1]?a[0]|64:a[0]&-65;a[0]=0>a[1]?a[0]|128:a[0]&-129};f=160;for(c=0;8>c;++c)l=f|c,b[l]=6==c?ta:n(ua,p[c]);b[230]=function(){G(k())};f=176;for(c=0;8>c;++c)l=f|c,b[l]=6==c?va:
n(wa,p[c]);b[246]=function(){H(k())};f=168;for(c=0;8>c;++c)l=f|c,b[l]=6==c?xa:n(ya,p[c]);b[238]=function(){I(k())};f=184;for(c=0;8>c;++c)l=f|c,b[l]=6==c?za:n(Aa,p[c]);b[254]=function(){J(k())};b[7]=function(){var b=a[1],b=b<<1|b>>7;a[1]=b;a[0]=b&1?a[0]|1:a[0]&-2};b[15]=function(){var b=a[1],b=b>>1|b<<7;a[1]=b;a[0]=b&128?a[0]|1:a[0]&-2};b[23]=function(){var b=a[1],c=a[0]&1;a[0]=b&128?a[0]|1:a[0]&-2;b<<=1;c&&(b|=1);a[1]=b};b[31]=function(){var b=a[1],c=a[0]&1;a[0]=b&1?a[0]|1:a[0]&-2;b>>=1;c&&(b|=128);
a[1]=b};b[47]=function(){a[1]^=255};b[63]=function(){a[0]^=1};b[55]=function(){a[0]|=1};b[195]=function(){d[5]=q()};f=194;for(c=0;4>c;++c)p=2*c,h=p+1,b[f|p<<3]=n(Ca,v[p]),b[f|h<<3]=n(Ba,v[h]);b[205]=function(){var a=q();t(d[5]);d[5]=a};f=196;for(c=0;4>c;++c)p=2*c,h=p+1,b[f|p<<3]=n(Ea,v[p]),b[f|h<<3]=n(Da,v[h]);b[201]=function(){d[5]=x()};f=192;for(c=0;4>c;++c)p=2*c,h=p+1,b[f|p<<3]=n(Ga,v[p]),b[f|h<<3]=n(Fa,v[h]);f=199;for(c=0;8>c;++c)b[f|c<<3]=n(Ha,c);b[233]=function(){d[5]=d[r]};f=197;for(c=0;4>
c;++c)b[f|c<<4]=3==c?n(W,0):n(W,m[c]);f=193;for(c=0;4>c;++c)b[f|c<<4]=3==c?n(X,0):n(X,m[c]);b[227]=function(){var a=d[4],b=w.getUint16(a,!0);w.setUint16(a,d[r],!0);d[r]=b};b[249]=function(){d[4]=d[r]};b[219]=function(){var b=k(),c;"function"==typeof K[b]&&(c=K[b]());a[1]=c};b[211]=function(){var b=k();if("function"==typeof L[b])L[b](a[1])};b[251]=function(){a[0]|=32};b[243]=function(){a[0]|=32};b[118]=function(){throw"HLT";};return u}};"undefined"!==typeof t&&(t.cpu8080=M)})(t)})(this);
